# Pillar Smart Wallet Overview

## Smart Wallet Fundamentals

A smart wallet can be defined in opposition to a simple Web3 wallet, like Leather or Xverse, where a compromised key means all assets can be depleted. A smart wallet is a contract that the user owns, which holds assets and enforces rules. These rules are enforced by the code and the Stacks blockchain, not by a server.

While a regular wallet is like a safe with a key, a smart wallet is like a safe with rules, such as time locks, spending limits, and two-factor authentication (2FA).

A smart wallet is set up on Pillar by deploying the smart wallet contract, and a passkey acts as the wallet's administrator.

## Passkey and Authentication

Pillar currently uses a third party called Privi. The user authenticates via their WebAuthn to Privi, which holds an encrypted, sharded private key. When the user authenticates, Privi decrypts the key and signs on the user's behalf; the user never has to touch or see the private key.

The signature goes on-chain to the smart wallet, which is associated with the user's public key, verifies the signature, and proceeds with the action. The passkey's private key is stored in the secure enclave (hardware chip) of the user's device.

With the upcoming Clarity 5, the developers are considering removing the second layer (Privi) to simplify the passkey authentication process. The passkey allows users to move assets easily by signing with their Face ID.

## Security and Rules

### Two-Factor Authorization

The Pillar smart wallet uses a 2FA authorization approach by allowing the configuration of a "principal admin". For critical operations, both the passkey and the principal admin are required. The principal admin is often referred to as a backup admin, but it is considered "senior" over the passkey admin.

If either credential is compromised, the hacker cannot gain full control because they do not own both, providing an "escape hatch" for the user to recover the wallet.

### Spending Thresholds

By default, the smart wallet has a spending threshold of 100 STX and 100,000 satoshis per day. If a transaction of STX or sBTC exceeds the daily threshold, it is flagged and goes into a 24-hour cool-down period (configurable).

During the cool-down, the user can veto the transaction, or after the cool-down, they can confirm it with either their passkey or admin wallet. The cumulative daily threshold prevents a hacker from draining the wallet by repeatedly withdrawing amounts just under the limit.

### Internal vs External Operations

Internal operations, such as a "boost" which supplies sBTC to the Zest protocol, are within the smart wallet's ownership and do not require as much protection. External operations involve sending STX, sBTC, or zsBTC out to any entity other than the smart wallet itself.

## Wallet Recovery and Transfer

Transferring a wallet can be used if the user wants to sell the entire portfolio or if either the passkey or the principal admin is compromised.

To transfer the wallet to a new admin, the owner must possess both the passkey and the principal admin. This transfer can be done instantly without a cool-down period. If only the principal admin is compromised, the hacker would still face a 24-hour cool-down to designate a new passkey.

### Recovery Admin

For ultimate recovery, a "recovery admin" or wallet (like a Leather or Xverse wallet) can be configured. If the smart wallet is inactive for more than one year (configurable), this recovery wallet can take over and recover the assets. An inactive smart wallet means the recovery wallet cannot take over while the wallet is active.

## Extensions

The smart wallet is modular, allowing users to add whitelisted extensions (e.g., for minting stSTX or liquid staking).

Adding an extension requires the principal admin to propose it, a cool-down period, and confirmation with the passkey. Removal of an extension is instant but requires both the passkey and the principal admin and a cool-down.

A malicious extension can create significant damage, which is why maximum security is needed when adding extensions. The developers are considering creating a registry of community-vetted extensions to enhance security.

## User Experience

The user experience is designed to be frictionless. If a transaction is below the threshold, the system may not ask the user to reconfirm after they have signed in with their passkey.

Pillar also abstracts the gas fee, broadcasting the user's signature to the Stacks blockchain with its own wallet.

## Upcoming Features

The Pillar smart wallet's upgraded version will cover "dual stacking," allowing the user's DeFi position on Zest to earn the maximum staking yield (around 5%). The developers are also working on solving gas sponsorship so that the app can be opened to anyone without requiring a passcode.
